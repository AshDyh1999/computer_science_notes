### 1. 设置root密码
```
sudo mysqladmin -uroot password '123' -S /data/3307/tmp/mysql.sock
```

### 2. 删除不必要的用户
```
drop user ""@centos1;
drop user ""@localhost;
drop user "root"@centos1;
```

### 3. 查询数据库时避免通配符
假设test只有id,name两个属性.那么`select id,name from test`会比使用通配符的`select * from test`效率高.因为后者需要匹配,前者直接插

### 4. 批量插入
```
insert into test values(1,'orris'),(2,'mirai');
```

### 5. 设置权限时采用最小权限
增删改查(insert,delete,update,select)就足够了

### 6. 安全
#### 6-1. 客户端访问控制
1. 更改client端口
2. 数据库web client端统一部署在1-2台不对外服务的web上,限制ip及端口,只能从办公室内网访问
3. 不做公网域名解析,用hosts实现访问,限制ip直接访问,或者用内网ip访问
4. web连接数据库的话,只能使用特定用户
5. 设置指定用户访问权限层次,Web层使用Apache/Nginx用户验证,数据库层使用MySQL用户登录验证
6. 统一所有数据库账户登录入口地址,禁止所有开发人员私自上传phpadmin等数据库管理程序
+ phpmyadmin是MySQl的图形化Web管理工具,可以放在Nginx/Apache里面,从而管理MySQL

### 7. 硬件优化
1. CPU和内存 8-16核CPU(64G-128G,3-4个实例)|2-4核CPU(32G-64G,2个实例)
2. 磁盘 越多越好.
+ SSD(高并发)>SAS(普通业务线上)>SATA(线下)
+ 4个磁盘的话:RAID0>RAID10(数据库一般选这个)>RAID5>RAID1
3. 网卡:多块网卡bond,以及buffer,tcp优化
### 8. 软件优化
1. 操作系统:x86_64
2. MySQL编译安装

### 9. my.cnf里的参数优化
注意:`my.cnf`优化幅度小
+ 不要记录访问日志
+ 调优工具:`mysqlreport`
### 10. SQL语句优化
1. 索引优化
+ 找慢查询
  - 白名单
  - 项目开发时DBA参与
  - `mysqlsla`:慢查询日志分析工具
  - 每天0点定时分析慢查询,发到核心开发,DBA,高级运维和CTO的邮箱里:DBA分析给出建议=>核心开发确认更改=>DBA线上操作处理
2. 复杂SQL语句拆分成小的SQL语句
+ 子查询
+ JOIN连表查询
+ 表太大,比如有5000W=>架构处理
3. 不要在数据库里做计算
+ 应用类处理,前端应用解决
4. 搜索功能不要用数据库,如`like '%xx%'`这样的语句
### 11. 架构上的优化
1. 业务拆分.比如搜索功能拆分出去,某些业务使用NoSQL持久化存储,如粉丝关注,好友关系等
2. 数据库前端使用缓存,如商品查询,用户登录
3. 动态的数据静态化,整个文件静态化,页面片段静态化
4. 数据库集群与读写分离. 
5. 单表超过2000W,拆库拆表(可能花几个月)
+ 查询数据库时,前面弄个代理层(如dbproxy).如果查的范围在0-1000W就选A,否则选B
### 12. 流程,制度,安全优化
任何一次人为的数据库更新,都要走一个流程
1. 人的流程:开发人员=>核心开发=>运维/DBA
2. 测试流程:内网测试=>IDC测试=>IDC上线
3. 客户端管理:如`phpmyadmin`管理端口为9999,其他客户端也是一样.或者只能通过VPN才能访问
